//======================================================================================================
/******************************************************************************************************
 *                                                                                                     
 *            文件名称:              
 *
 *                摘要: 
 *
 *            创建时间: 2012-05-xx  
 *
 *            修改时间: 2012-05-xx
 *            修改原因:
 *
 *            
 *
 *                作者: 杨卫华
 *
 *******************************************************************************************************/
//======================================================================================================
#include "mystd.h"  
#include "m_config.h"
#include "Queue.h"


//======================================================================================================
/*******************************************************************************************************
 *
 *         函数名称: 
 *
 *         函数功能: 
 *
 *         入口参数: 
 *
 *         出口参数: 无
 *
 *             说明:
 *
 *******************************************************************************************************/
void InitQueue(QUEUE *pq, uint8_t *pd, uint16_t size, uint8_t em_full)
{
    pq->size         = size;
    pq->front        = 0;
    pq->front_back   = 0;
    pq->state        = em_full;
    pq->r_new        = 0;//是否接收了新数据
    pq->qb           = pd; 

    if (em_full == Q_EMPTY)
    {
        pq->rear    = 0;

    }
    else if (em_full == Q_FULL)
    {
        pq->rear   = pq->size - 1;

    }
    
}


//======================================================================================================
/*******************************************************************************************************
 *
 *         函数名称: 
 *
 *         函数功能: 
 *
 *         入口参数: 
 *
 *         出口参数: 无
 *
 *             说明:
 *
 *******************************************************************************************************/
void Store2Q(QUEUE *pq, uint8_t byte)
{
    if (((pq->rear + 1) & pq->size) != pq->front)
    {
        *(pq->qb + pq->rear) = (byte);
        pq->rear = (pq->rear + 1) % pq->size; 
        pq->state = Q_NORMAL;
    }
    else
    {
        pq->tmp_rbuff[0] =  byte;
        pq->state        = Q_FULL;

    }
    
}



//======================================================================================================
/*******************************************************************************************************
 *
 *         函数名称: 
 *
 *         函数功能: 
 *
 *         入口参数: 
 *
 *         出口参数: 无
 *
 *             说明:
 *
 *******************************************************************************************************/
uint8_t FetchFromQ(QUEUE *pq)
{
    uint8_t tmp =  0;

    if (pq->front != pq->rear)
    {
         tmp       =  (pq->qb[pq->front] & 0xFF); 
         pq->front = (pq->front + 1) % pq->size;
    }
    else
    {
        pq->state  = Q_EMPTY;
        
    
    }
    
    return tmp;

}

